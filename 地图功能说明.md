# 事件分布地图功能说明

## 功能概述

参考 `https://feiyi.inhct.cn/map.html` 实现的事件分布地图，使用Canvas绘制，支持区域颜色编码、标签显示、筛选等功能。

## 已实现功能

### 1. 区域颜色编码 ✅
- 根据每个区域的事件数量，自动填充不同颜色
- 颜色范围：
  - **150件以上**：金黄色 (#FFD700)
  - **120-150件**：橙色 (#FFA500)
  - **90-120件**：红橙色 (#FF6347)
  - **60-90件**：粉红色 (#FF69B4)
  - **30-60件**：紫色 (#9370DB)
  - **30件以下**：天蓝色 (#87CEEB)

### 2. 区域标签显示 ✅
- 在每个区域中心显示区域名称和事件数量
- 格式：`区域名 X件`（如"阜阳 50件"）
- 标签带白色背景框，便于阅读

### 3. 完整图例 ✅
- 左下角显示颜色图例
- 清晰标注每个颜色对应的数值范围
- 与地图区域颜色保持一致

### 4. 下拉筛选功能 ✅
- **事件类型筛选**：可选择全部事件、军事事件、社会事件、地理变迁
- **地区筛选**：可选择全部地区或具体城市（阜阳、亳州、淮北等）
- 筛选后自动更新地图显示和区域统计

### 5. 返回按钮 ✅
- 左上角返回按钮，可返回地理地图页面
- 带图标和悬停效果

### 6. 边界线条粗细区分 ✅
- **市级边界**：2.5px，深色 (#333)
- **县级边界**：0.8px，浅色 (#999)
- 清晰区分不同级别的行政边界

### 7. 交互功能 ✅
- **鼠标拖拽**：平移地图
- **滚轮缩放**：以鼠标位置为中心缩放
- **区域悬停**：显示区域名称和事件数量提示
- **区域点击**：显示该区域的所有事件列表

### 8. 区域统计 ✅
- 自动统计每个区域的事件数量
- 支持筛选后的动态统计
- 统计结果实时更新到地图显示

## 技术实现

### Canvas绘制
- 使用原生Canvas API绘制地图
- 支持高分辨率显示
- 流畅的交互体验

### 坐标转换
- 地理坐标（经纬度）↔ Canvas坐标（像素）
- 支持缩放和平移
- 精确的点定位

### 区域检测
- 使用点在多边形内算法
- 支持Polygon和MultiPolygon
- 实时检测鼠标悬停区域

### 数据统计
- 自动按地区分组统计事件
- 支持动态筛选和重新统计
- 高效的数据处理算法

## 使用方法

1. **访问页面**：打开 `map-canvas.html`
2. **筛选数据**：使用顶部的下拉菜单筛选事件类型和地区
3. **查看详情**：
   - 鼠标悬停在区域上查看统计信息
   - 点击区域查看该区域的所有事件
4. **地图操作**：
   - 拖拽鼠标：平移地图
   - 滚轮：缩放地图
   - 点击返回按钮：返回地理地图页面

## 数据要求

### 事件数据格式
```json
{
  "properties": {
    "事件名称": "事件名称",
    "地区": "阜阳市",
    "发生时间": "时间",
    "突发事件": "事件类型"
  },
  "properties": {
    "lng": 116.06638,
    "lat": 33.130892
  }
}
```

### 边界数据格式
- GeoJSON格式
- 支持Polygon和MultiPolygon
- 需要包含区域名称属性

## 文件结构

```
map-canvas.html      # 地图页面
map-canvas.js        # 地图逻辑脚本
data.json            # 事件数据
boundaries/          # 边界GeoJSON数据
  ├── 亳州市.json
  ├── 淮北市.json
  ├── 阜阳市.json
  └── ...
```

## 浏览器兼容性

- Chrome/Edge (推荐)
- Firefox
- Safari
- 需要支持Canvas API

## 性能优化

- 使用Canvas 2D渲染，性能优异
- 按需重绘，减少不必要的绘制
- 高效的区域检测算法
- 支持大量数据点的流畅显示

## 后续优化建议

1. 添加动画效果（区域颜色渐变）
2. 支持导出地图图片
3. 添加时间轴筛选
4. 支持更多筛选条件
5. 添加数据钻取功能（点击区域查看详细列表）





























